<!DOCTYPE html>
<html lang="nl"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Catalogus – Rental Platform</title>

    <style>
        /* ========== DESIGN SYSTEM ========== */
        :root{
            --primary:#6366F1;
            --primary-dark:#4F46E5;
            --success:#22C55E;
            --danger:#EF4444;

            --bg:#F4F6F8;
            --surface:#FFFFFF;
            --border:#E5E7EB;

            --text:#111827;
            --text-muted:#64748B;

            --nav:#0F172A;
        }

        *{box-sizing:border-box}
        body{
            margin:0;
            font-family:'Inter','Segoe UI',system-ui,sans-serif;
            background:var(--bg);
            color:var(--text);
        }

        a{text-decoration:none;color:inherit}

        /* ========== NAVBAR ========== */
        nav{
            background:var(--nav);
            color:white;
            padding:14px 28px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            box-shadow:0 8px 30px rgba(15,23,42,.6);
            position:sticky;
            top:0;
            z-index:100;
        }

        .nav-left,.nav-right{
            display:flex;
            align-items:center;
            gap:18px;
        }

        nav a{
            color:#E5E7EB;
            font-weight:600;
            font-size:14px;
            transition:.2s;
        }

        nav a:hover{
            color:white;
            transform:translateY(-1px);
        }

        .nav-cart{
            position:relative;
            width:36px;
            height:36px;
            display:flex;
            align-items:center;
            justify-content:center;
            border-radius:12px;
            background:rgba(255,255,255,.08);
            border:1px solid rgba(255,255,255,.15);
            transition:.2s;
        }

        .nav-cart:hover{
            background:rgba(99,102,241,.25);
            border-color:var(--primary);
            transform:translateY(-1px);
        }

        .nav-cart svg{
            width:18px;
            height:18px;
            fill:white;
        }

        .cart-badge{
            position:absolute;
            top:-6px;
            right:-8px;
            background:var(--success);
            color:white;
            font-size:11px;
            padding:2px 7px;
            border-radius:999px;
            font-weight:800;
            border:2px solid var(--nav);
        }

        nav form{display:inline}
        nav button{
            background:none;
            border:none;
            color:#E5E7EB;
            font-weight:600;
            cursor:pointer;
        }
        nav button:hover{color:white}

        /* ========== TOAST (SUCCESS MESSAGE) ========== */
        .toast-success{
            position: fixed;
            top: 84px;
            right: 20px;
            z-index: 9999;

            background: var(--success);
            color: white;
            font-weight: 800;
            font-size: 14px;
            padding: 12px 16px;
            border-radius: 14px;
            box-shadow: 0 14px 40px rgba(15,23,42,.25);
            animation: toastIn .22s ease-out;
            max-width: 360px;
        }

        @keyframes toastIn{
            from{transform:translateY(-10px); opacity:0;}
            to{transform:translateY(0); opacity:1;}
        }

        /* ========== PAGE ========== */
        .page{
            width:95%;
            max-width:1300px;
            margin:32px auto;
            animation:fadeUp .45s ease-out;
        }

        @keyframes fadeUp{
            from{opacity:0;transform:translateY(12px)}
            to{opacity:1;transform:translateY(0)}
        }

        h1{
            font-size:30px;
            font-weight:800;
            margin:0 0 6px;
        }

        .subtitle{
            color:var(--text-muted);
            margin-bottom:22px;
        }

        /* ========== FILTERS ========== */
        .filters{
            background:var(--surface);
            border:1px solid var(--border);
            border-radius:18px;
            padding:18px;
            display:flex;
            flex-wrap:wrap;
            gap:14px;
            align-items:end;
            box-shadow:0 12px 35px rgba(15,23,42,.08);
            margin-bottom:24px;
        }

        .filter-group{
            display:flex;
            flex-direction:column;
            gap:6px;
        }

        label{
            font-size:12px;
            font-weight:800;
            color:var(--text-muted);
            letter-spacing:.05em;
            text-transform:uppercase;
        }

        input,select{
            padding:11px 14px;
            border-radius:12px;
            border:1px solid #D1D5DB;
            background:#F9FAFB;
            font-size:14px;
        }

        input:focus,select:focus{
            outline:none;
            border-color:var(--primary);
            box-shadow:0 0 0 3px rgba(99,102,241,.25);
            background:white;
        }

        .btn-primary{
            background:linear-gradient(135deg,var(--primary),var(--primary-dark));
            color:white;
            border:none;
            border-radius:14px;
            padding:12px 18px;
            font-weight:800;
            cursor:pointer;
            transition:.2s;
        }

        .btn-primary:hover{
            transform:translateY(-1px);
            filter:brightness(1.05);
        }

        /* ========== GRID ========== */
        .grid{
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
            gap:22px;
        }

        .card{
            background:var(--surface);
            border:1px solid var(--border);
            border-radius:20px;
            padding:20px;
            box-shadow:0 14px 40px rgba(15,23,42,.1);
            transition:.25s;
            display:flex;
            flex-direction:column;
            justify-content:space-between;
        }

        .card:hover{
            transform:translateY(-4px);
            box-shadow:0 22px 55px rgba(15,23,42,.18);
        }

        .card h3{
            margin:0 0 4px;
            font-size:18px;
            font-weight:800;
        }

        .category{
            display:inline-block;
            font-size:11px;
            font-weight:800;
            padding:4px 10px;
            border-radius:999px;
            background:#EEF2FF;
            color:var(--primary-dark);
            margin-bottom:10px;
        }

        .desc{
            color:#334155;
            font-size:14px;
            margin-bottom:14px;
        }

        .price{
            font-size:18px;
            font-weight:900;
            margin-bottom:4px;
        }

        .stock{
            color:var(--text-muted);
            font-size:13px;
            margin-bottom:14px;
        }

        .add{
            background:var(--nav);
            color:white;
            text-align:center;
            padding:12px;
            border-radius:14px;
            font-weight:800;
            transition:.2s;
        }

        .add:hover{
            background:var(--primary);
            transform:translateY(-1px);
        }

        .empty{
            background:var(--surface);
            border:1px dashed var(--border);
            padding:28px;
            border-radius:18px;
            text-align:center;
            color:var(--text-muted);
        }
    </style>
</head>

<body>

<nav>
    <div class="nav-left">
        <!-- CART FIRST -->
        <a href="/cart" class="nav-cart">
            <svg viewBox="0 0 24 24">
                <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2Zm10 0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2ZM7.17 14h9.66c.75 0 1.4-.41 1.74-1.03l3.24-5.88a1 1 0 0 0-.88-1.48H6.21L5.27 2H2v2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 8 16h12v-2H8l1.17-2Z"/>
            </svg>
            <span class="cart-badge" th:if="${cartCount>0}" th:text="${cartCount}">0</span>
        </a>

        <a href="/dashboard">Dashboard</a>
        <a href="/catalog">Catalogus</a>
        <a href="/orders">Mijn reservaties</a>
    </div>

    <div class="nav-right">
        <span sec:authorize="!isAuthenticated()">
            <a href="/login">Inloggen</a>
            <a href="/register">Registreren</a>
        </span>
        <span sec:authorize="isAuthenticated()">
            <a href="/profile">Profiel</a> |
            <form th:action="@{/logout}" method="post">
                <button>Uitloggen</button>
            </form>
        </span>
    </div>
</nav>

<!-- ✅ Groene notificatie na toevoegen -->
<div th:if="${successMessage}" class="toast-success" th:text="${successMessage}"></div>

<div class="page">
    <h1>Catalogus</h1>
    <div class="subtitle">
        Kies materiaal en voeg het toe aan je mandje. De huurperiode bepaal je later.
    </div>

    <form class="filters" method="get" action="/catalog">
        <div class="filter-group">
            <label>Categorie</label>
            <select name="categoryId">
                <option value="" th:selected="${selectedCategoryId == null}">
                    Alle categorieën
                </option>

                <option th:each="c : ${categories}"
                        th:value="${c.id}"
                        th:text="${c.name}"
                        th:selected="${selectedCategoryId != null and c.id == selectedCategoryId}">
                </option>
            </select>

        </div>

        <div class="filter-group">
            <label>Zoeken</label>
            <input type="text" name="search" placeholder="Zoek product…" th:value="${search}">
        </div>

        <button class="btn-primary" type="submit">Filter</button>
    </form>

    <div class="empty" th:if="${#lists.isEmpty(products)}">
        Geen producten gevonden voor deze filters.
    </div>

    <div class="grid">
        <div class="card" th:each="product : ${products}">
            <div>
                <span class="category" th:text="${product.category.name}">Categorie</span>
                <h3 th:text="${product.name}">Product</h3>
                <div class="desc" th:text="${product.description}">Beschrijving</div>
            </div>

            <div>
                <div class="price" th:text="${product.dailyPrice} + ' €/dag'">0 €/dag</div>
                <div class="stock">Voorraad: <strong th:text="${product.stock}">0</strong></div>
                <a class="add" th:href="@{'/cart/add/' + ${product.id}}">
                    Toevoegen aan mandje
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // ✅ Toast automatisch laten verdwijnen na 2.5 seconden
    setTimeout(() => {
        const el = document.querySelector('.toast-success');
        if (el) el.style.display = 'none';
    }, 2500);
</script>

</body>
</html>
